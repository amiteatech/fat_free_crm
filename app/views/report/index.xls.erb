<?xml version="1.0"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:html="http://www.w3.org/TR/REC-html40">
  <Worksheet ss:Name="Sheet1">
    <Table>
      <Row>
        <Cell><Data ss:Type="Number">Number</Data></Cell>
        <Cell><Data ss:Type="String">Task Title</Data></Cell>
        <Cell><Data ss:Type="String">Type</Data></Cell>
        <Cell><Data ss:Type="String">Form</Data></Cell>
        <Cell><Data ss:Type="String">Year</Data></Cell>
        <Cell><Data ss:Type="String">Edutrust Item Number</Data></Cell>
        <Cell><Data ss:Type="String">Due date</Data></Cell>
        <Cell><Data ss:Type="String">Staff</Data></Cell>
        <Cell><Data ss:Type="String">Status</Data></Cell>
      </Row>
    <% @tasks.each do |task| %>
      <Row>
        <Cell><Data ss:Type="Number"><%= task.id %></Data></Cell>
        <Cell><Data ss:Type="String">
          <% if task.user.present? && (task.user.id != current_user.id) %>
            <%= t(:task_from, h(task.user.full_name)).html_safe << ':' %>
          <% end %>
          <%= task.name %>
        </Data></Cell>
        <Cell><Data ss:Type="String">
          <% if task.task_form_tag_id.present? %>
            <% if TaskFormTag.where(id: task.task_form_tag_id).first.present? %>
              <%= TaskFormTag.where(id: task.task_form_tag_id).first.name %>
            <% end %>
          <% end %>
        </Data></Cell>
        <Cell><Data ss:Type="String"><%=  %></Data></Cell>
        <Cell><Data ss:Type="String"><%=  %></Data></Cell>
        <Cell><Data ss:Type="String"><%=  %></Data></Cell>
        <Cell><Data ss:Type="String">
          <% if task.due_at.present? %>
            <%= task.due_at.strftime('%Y-%m-%d %H:%M') %>
          <% end %>
        </Data></Cell>
        <Cell><Data ss:Type="String">
          <% task.user_tasks.where.not(id: task.task_created_id).each do |user_task| %>
            <%  @user = User.find(user_task.user_id) %>
            <%= @user.name %><%= (task.user_tasks.where.not(id: task.task_created_id).last == user_task) ? "" : "," %>
          <% end %>
        </Data></Cell>
        <Cell><Data ss:Type="String"><%= task.task_status %></Data></Cell>
      </Row>
    <% end %>
    </Table>
  </Worksheet>
</Workbook>